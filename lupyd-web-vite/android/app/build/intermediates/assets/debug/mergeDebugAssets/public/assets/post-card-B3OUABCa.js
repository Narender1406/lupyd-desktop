import{n as N,r as u,j as e,B as x,T as H,a as q,b as M,c as V,I as z,ak as O,J as G,a0 as n,C as U,d as J,L as K,a3 as A,e as Z,f as Q,an as X,g as Y,ao as ee,M as se,a5 as te,ap as ae,aq as ne}from"./index-Fc6vCu0Z.js";import{D as oe,a as le,b as ie,e as $}from"./dropdown-menu-UOyrN3MW.js";import{D as ce,d as re,a as de,b as me,c as he}from"./dialog-eDhKFWIA.js";import{t as L}from"./use-toast-MZkaCwcs.js";import{S as xe}from"./share-2-CGPvXKVm.js";import{M as pe}from"./mail-BzArNo9P.js";import{L as ue,v as fe}from"./van-CsB0LuL7.js";import{T as we}from"./thumbs-up-B2JpGGy2.js";import{S as je}from"./send-B9-vH_sY.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],ke=N("copy",ge);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M10 5a2 2 0 0 0-1.344.519l-6.328 5.74a1 1 0 0 0 0 1.481l6.328 5.741A2 2 0 0 0 10 19h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2z",key:"1yo7s0"}],["path",{d:"m12 9 6 6",key:"anjzzh"}],["path",{d:"m18 9-6 6",key:"1fp51s"}]],ye=N("delete",ve);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]],Ce=N("facebook",be);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],Te=N("flag",Ne);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]],De=N("linkedin",Pe);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]],Se=N("thumbs-down",Le);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]],Ee=N("twitter",_e);function Me({title:o,url:t,children:k}){const[w,m]=u.useState(!1),[v,p]=u.useState(!1),h=()=>{navigator.clipboard.writeText(t),m(!0),L({title:"Link copied",description:"The link has been copied to your clipboard"}),setTimeout(()=>m(!1),2e3)},c=()=>{window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(o)}&url=${encodeURIComponent(t)}`,"_blank"),p(!1)},j=()=>{window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(t)}`,"_blank"),p(!1)},r=()=>{window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(t)}`,"_blank"),p(!1)},y=()=>{window.open(`mailto:?subject=${encodeURIComponent(o)}&body=${encodeURIComponent(`Check out this post: ${t}`)}`,"_blank"),p(!1)};return e.jsxs(ce,{open:v,onOpenChange:p,children:[e.jsx(re,{asChild:!0,children:k||e.jsxs(x,{variant:"ghost",size:"sm",className:"flex items-center space-x-1 px-2",children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsx("span",{children:"Share"})]})}),e.jsxs(de,{className:"sm:max-w-md",children:[e.jsx(me,{children:e.jsx(he,{children:"Share this post"})}),e.jsxs(H,{defaultValue:"social",className:"w-full",children:[e.jsxs(q,{className:"grid w-full grid-cols-2",children:[e.jsx(M,{value:"social",children:"Social Media"}),e.jsx(M,{value:"link",children:"Copy Link"})]}),e.jsx(V,{value:"social",className:"mt-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(x,{variant:"outline",className:"flex items-center justify-center gap-2 h-12",onClick:c,children:[e.jsx(Ee,{className:"h-5 w-5"}),e.jsx("span",{children:"Twitter"})]}),e.jsxs(x,{variant:"outline",className:"flex items-center justify-center gap-2 h-12",onClick:j,children:[e.jsx(Ce,{className:"h-5 w-5"}),e.jsx("span",{children:"Facebook"})]}),e.jsxs(x,{variant:"outline",className:"flex items-center justify-center gap-2 h-12",onClick:r,children:[e.jsx(De,{className:"h-5 w-5"}),e.jsx("span",{children:"LinkedIn"})]}),e.jsxs(x,{variant:"outline",className:"flex items-center justify-center gap-2 h-12",onClick:y,children:[e.jsx(pe,{className:"h-5 w-5"}),e.jsx("span",{children:"Email"})]})]})}),e.jsx(V,{value:"link",className:"mt-4",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"grid flex-1 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Post Link"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{value:t,readOnly:!0,className:"flex-1"}),e.jsx(x,{size:"sm",className:"ml-2 bg-black text-white hover:bg-gray-800",onClick:h,children:w?e.jsx(O,{className:"h-4 w-4"}):e.jsx(ke,{className:"h-4 w-4"})})]})]})})})]})]})]})}function Ve(o){const t=o.post,[k,w]=u.useState(!1),[m,v]=u.useState(""),[p,h]=u.useState(t.vote?.val===!0),[c,j]=u.useState(t.vote?.val===!1),[r,y]=u.useState(Number(t.upvotes)),[T,P]=u.useState(Number(t.downvotes)),[g,D]=u.useState([]),f=G(),S=async()=>{if(g.length==0){const i={fetchType:n.FetchType.Replies,fetchTypeFields:n.ulidStringify(t.id)},C=await n.getPosts(i);D(C)}w(!k)},s=()=>{console.log(`Commenting on post ${n.ulidStringify(t.id)}: ${m}`);const i=n.PostProtos.CreatePostDetails.create({replyingTo:t.id,postType:t.postType,expiry:t.expiry,body:n.PostProtos.PostBody.create({plainText:m})});L({title:"Commenting..."}),n.createPost(i).then(C=>{C&&D(_=>[C,..._]),v("")}).catch(C=>{console.error(C),L({title:"Failed to create comment"})})},d=async()=>{let i;c&&(j(!1),P(T-1),i=n.PostProtos.BoolValue.create({val:!0})),p?(h(!1),y(r-1)):(h(!0),y(r+1),i=n.PostProtos.BoolValue.create({val:!0})),await n.putVote(n.PostProtos.Vote.create({id:t.id,val:i}))},a=async()=>{let i;p&&(h(!1),y(r-1),i=n.PostProtos.BoolValue.create({val:!1})),c?(j(!1),P(T-1)):(j(!0),P(T+1),i=n.PostProtos.BoolValue.create({val:!1})),await n.putVote(n.PostProtos.Vote.create({id:t.id,val:i}))},l=`${window.origin}/post/${n.ulidStringify(t.id)}`,[b,E]=u.useState(!1),R=async()=>{await n.reportPost(t.id,""),E(!1),L({title:"Post has been reported"})},I=async()=>{await n.deletePost(t.id),L({title:"Post has been deleted"}),o.onDelete&&o.onDelete(t.id)};function B(){alert("Successfully Saved Post")}return e.jsxs(U,{className:"border-none shadow-sm mx-auto w-full max-w-[560px] sm:max-w-[640px] md:max-w-[700px] lg:max-w-[740px]",children:[e.jsx(J,{className:"p-4 pb-0",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(K,{to:`/user/${t.by}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(A,{username:t.by}),e.jsxs("div",{children:[e.jsx(Z,{className:"text-base",children:t.by}),e.jsx(Q,{className:"text-xs",children:n.dateToRelativeString(new Date(n.getTimestampFromUlid(t.id)))})]})]})}),e.jsxs(oe,{open:b,onOpenChange:i=>E(i),children:[e.jsx(le,{asChild:!0,children:e.jsx(x,{variant:"ghost",children:e.jsx(X,{})})}),e.jsxs(ie,{children:[e.jsx($,{onClick:()=>{R(),alert("Successfully reported!")},children:e.jsxs("div",{className:"flex items-center cursor-pointer",children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Report"})]})}),f.username===t.by&&e.jsx($,{onClick:I,children:e.jsxs("div",{className:"flex items-center cursor-pointer",children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Delete"})]})})]})]})]})}),e.jsxs(Y,{className:"p-4",children:[e.jsx("p",{className:"mb-4",children:t.title}),t.body.length>0&&e.jsx(ee,{children:e.jsx(Ae,{...n.PostProtos.PostBodies.decode(t.body)})}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(x,{variant:"ghost",size:"sm",className:`flex items-center space-x-1 px-2 ${p?"text-black":""}`,onClick:d,children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{children:r})]}),e.jsxs(x,{variant:"ghost",size:"sm",className:`flex items-center space-x-1 px-2 ${c?"text-black":""}`,onClick:a,children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx("span",{children:T})]}),e.jsxs(x,{variant:"ghost",size:"sm",className:"flex items-center space-x-1 px-2",onClick:S,children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx("span",{children:t.replies})]}),e.jsx(Me,{title:t.title,url:l})]}),e.jsx(x,{variant:"ghost",size:"sm",className:"px-2",onClick:B,children:e.jsx(te,{className:"h-4 w-4"})})]}),k&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(A,{username:f.username??""}),e.jsx(z,{placeholder:"Write a comment...",className:"flex-1",value:m,onChange:i=>v(i.target.value)}),e.jsx(x,{size:"icon",className:"bg-black text-white hover:bg-gray-800",disabled:!m.trim(),onClick:s,children:e.jsx(je,{className:"h-4 w-4"})})]}),g.length>0?e.jsx("div",{className:"space-y-1",children:g.map((i,C)=>e.jsx("div",{children:e.jsx(Ve,{post:i,onDelete:_=>D(W=>W.filter(F=>!indexedDB.cmp(F.id,_)))})},n.ulidStringify(i.id)))}):e.jsx("p",{className:"text-center text-sm text-muted-foreground py-4",children:"No comments yet. Be the first to comment!"})]})]})]})}function Ae(o){return o.bodies.length>0?e.jsx($e,{...o.bodies[o.bodies.length-1]}):e.jsx("div",{})}function $e(o){if(o.markdown){const t={markdown:o.markdown,pickedFileUrls:[]};return e.jsx(ze,{...t})}else return o.plainText?e.jsx("p",{children:o.plainText}):e.jsx("p",{})}function ze(o){const{markdown:t,pickedFileUrls:k}=o,w=u.useRef(null),{showDialog:m,closeDialog:v}=ae(),p=h=>{let c;try{c=new URL(h)}catch{h.startsWith("/")?c=new URL(window.location.origin+h):c=new URL(window.location.origin+window.location.pathname+"/"+h)}c&&c.host!=window.location.host&&m(e.jsxs(U,{children:[e.jsx("p",{children:"The url might take you somewhere unsafe, Do you wish to proceed?"}),e.jsx("b",{children:c.toString()}),e.jsx(x,{onClick:()=>{window.open(c,"_blank","noopener,noreferrer"),v()},children:"Continue"})]}))};return u.useEffect(()=>{w.current&&Ue(t,k,p).then(h=>w.current?.replaceChildren(h))},[]),e.jsx("div",{ref:w,className:"lupyd-markdown",children:t})}async function Ue(o,t,k){const{micromark:w}=await ne(async()=>{const{micromark:s}=await import("./index-X-4KBu6c.js");return{micromark:s}},[],import.meta.url);let m=o;for(const s of t)m=m.replaceAll(s.blobUrl,s.cdnUrl);let c=w(m,{allowDangerousHtml:!1,allowDangerousProtocol:!1,extensions:[],htmlExtensions:[]});for(const s of t)c=c.replaceAll(s.cdnUrl,s.blobUrl);const{span:j,div:r,audio:y,video:T,a:P}=fe.tags,g=r({innerHTML:c,class:"lupyd-markdown"});Array.from(g.querySelectorAll("img")).forEach(s=>{if(["|Video|","|Audio|","|File|"].some(l=>s.alt.startsWith(l))){const l=P({textContent:s.alt,href:s.src});s.replaceWith(l);return}s.loading="lazy";try{s.decoding="async"}catch{}s.classList.add("w-full","h-full","object-contain");const a=r({class:"media-image-window relative rounded-md overflow-hidden mb-4 bg-black/5 w-full h-[360px] sm:h-[440px] md:h-[520px]"},s.cloneNode());s.replaceWith(a)}),g.querySelectorAll("a").forEach(s=>{const d=s.href;if(s.textContent&&s.textContent.startsWith("|Video|")){const a=(s.textContent??"").replace("|Video|",""),l=T({src:d,preload:"metadata",controls:!0,title:a});l.setAttribute("data-src",d),l.className="w-full h-full object-contain bg-black/90";const b=r({class:"media-video-window relative rounded-md overflow-hidden mb-4 w-full h-[360px] sm:h-[440px] md:h-[520px] bg-black/5"},l);s.replaceWith(b)}else if(s.textContent&&s.textContent.startsWith("|Audio|")){const a=(s.textContent??"").replace("|Audio|",""),l=y({src:d,title:a,controls:!0,preload:"metadata"});l.setAttribute("data-src",d),s.replaceWith(r({class:"rounded-md overflow-hidden mb-4"},l))}else if(s.textContent&&s.textContent.startsWith("|File|")){let a=(s.textContent??"").replace("|File|",""),l="";const b=a.indexOf("|");b>0&&(l=a.slice(0,b),new RegExp(/[0-9]+(\.[0-9]+)?[KMGTP]?B/).test(l)?a=a.slice(b+1):l=""),s.download=a,s.target="_blank",s.classList.add("theme-anchor"),s.replaceChildren(j(a),j(l))}else s.classList.add("theme-anchor"),s.target="_blank",s.onclick=a=>{a.preventDefault(),k(s.href)}}),Array.from(g.querySelectorAll("p")).forEach(s=>{if(s.childElementCount===1&&(s.textContent??"").trim()===""&&s.firstElementChild?.classList.contains("media-image-window")){const d=s.firstElementChild;s.replaceWith(d)}});const D=Array.from(g.childNodes);let f=[];const S=()=>{if(f.length>1){const s=r({class:"flex overflow-x-auto gap-2 snap-x snap-mandatory scroll-smooth w-full -mx-0"});f.forEach(a=>{const l=r({class:"w-full shrink-0 snap-center"},a);s.appendChild(l)});const d=r({class:"relative mb-4"},s);f[0].replaceWith(d);for(let a=1;a<f.length;a++)f[a].remove()}f=[]};return D.forEach(s=>{if(s.nodeType===1){const d=s;if(d.classList.contains("media-image-window")){f.push(d);return}}S()}),S(),g}export{Ve as P,$e as a};
