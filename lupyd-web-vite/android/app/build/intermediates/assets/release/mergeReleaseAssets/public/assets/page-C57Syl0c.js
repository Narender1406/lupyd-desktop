import{u as y,r as n,J as N,a0 as d,j as e,D as E,L,a3 as T}from"./index-BQMOqxJW.js";import{A as b}from"./animated-card-DfqHQIti.js";import{u as R}from"./firefly-context-DPtGHoOs.js";function I(){y();const[M,S]=n.useState("messages"),[C,$]=n.useState(""),[w,H]=n.useState(null),[A,U]=n.useState(!1),[k,D]=n.useState(!1),x=n.useRef(null),m=n.useRef(null),a=n.useRef(null);n.useRef(null);const c=()=>{const r=window.innerHeight,t=window.innerWidth;if(m.current){const i=w?140:80,o=r-64-i;m.current.style.height=`${o}px`,m.current.style.maxHeight=`${o}px`}if(a.current){const s=t>=768?256:0;a.current.style.position="fixed",a.current.style.bottom="0",a.current.style.width=t>=768?`calc(100% - ${s}px)`:"100%",a.current.style.left=t>=768?`${s}px`:"0",a.current.style.zIndex="50"}x.current&&setTimeout(()=>{x.current?.scrollIntoView({behavior:"smooth"})},100)},[g,p]=n.useState([]),l=N(),v=(r,t)=>{t.userMessage&&p(s=>{const i=[],o=t.userMessage.from==l.username?t.userMessage.to:t.userMessage.from;i.push(t.userMessage);for(let h=0;h<s.length;h++){const u=s[h],j=u.from==l.username?u.to:u.from;o!=j&&i.push(u)}return i})},f=R();return n.useEffect(()=>(f.addEventListener(v),()=>{f.removeEventListener(v)}),[]),n.useEffect(()=>{l.username&&f.client.getUserChats().then(r=>{r=r.sort((t,s)=>d.getTimestampFromUlid(t.id)-d.getTimestampFromUlid(s.id)),p(r)})},[l]),n.useEffect(()=>(c(),window.addEventListener("resize",c),window.addEventListener("orientationchange",c),()=>{window.removeEventListener("resize",c),window.removeEventListener("orientationchange",c)})),e.jsx(E,{children:e.jsx("div",{className:"flex flex-1 overflow-hidden",children:e.jsxs("div",{className:"divide-y w-full",children:[g.length==0&&e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("h2",{className:"text-center font-bold text-xl",children:"You have no open conversations"})}),g.map((r,t)=>{const s=l.username==r.from?r.to:r.from,i=r.text,o=new Date(d.getTimestampFromUlid(r.id));return e.jsx(b,{delay:.1*(t+1),children:e.jsx(L,{to:`/messages/${s}`,children:e.jsx("div",{className:"p-4 hover:bg-gray-50 cursor-pointer",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(T,{username:s}),!1]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between w-full max-w-[800px]",children:[e.jsx("p",{className:"font-medium truncate ",children:s}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d.dateToRelativeString(o)})]})}),e.jsx("p",{className:"text-sm truncate text-muted-foreground",children:i})]})]})})})},s)})]})})})}export{I as default};
