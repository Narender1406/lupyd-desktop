import{n as d,a4 as V,J,u as X,r as c,j as e,B as i,aj as G,a3 as j,an as W,a0 as r,ai as Z,X as S,I as Q}from"./index-BQMOqxJW.js";import{P as C,a as E,b as T}from"./popover-Cz69fGq9.js";import{u as Y,d as w}from"./firefly-context-DPtGHoOs.js";import{D as ee,a as se,b as te,e as v}from"./dropdown-menu-BRjx-zb6.js";import{I as ae,S as U}from"./index.es-DLlNA55s.js";import{t as ie}from"./use-toast-CCyZQtCu.js";import{P as ne}from"./phone-no1gseOD.js";import{V as re}from"./video-E8zllIXl.js";import{I as le}from"./image-CM1tGAhc.js";import{S as ce}from"./send-DHNXlGmv.js";import"./chevron-right-DOyZUz7b.js";import"./circle-yRhyIrH_.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"m15 17 5-5-5-5",key:"nf172w"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]],de=d("forward",oe);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],he=d("info",me);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],$=d("loader",xe);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],fe=d("mic",pe);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],_=d("paperclip",ue);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],F=d("reply",ge),I=["üëç","‚ù§Ô∏è","üòÇ","üòÆ","üò¢","üôè","üî•","‚ú®","üéâ","üëè"];function Ue(){const n=V().username?.toString(),f=J(),D=X(),[x,N]=c.useState([]),m=Y(),[R,y]=c.useState(!1);function O(s,t){const a=[];let o=0,l=0;for(;o<s.length&&l<t.length;)r.getTimestampFromUlid(s[o].id)<r.getTimestampFromUlid(t[l].id)?a.push(s[o++]):a.push(t[l++]);for(;o<s.length;)a.push(s[o++]);for(;l<t.length;)a.push(t[l++]);return a}const P=(s,t)=>{if(s.length>0){if(r.getTimestampFromUlid(s[s.length-1].id)<r.getTimestampFromUlid(t.id))return[...s,t];{let a=0;for(;a<s.length&&!(r.getTimestampFromUlid(s[a].id)>r.getTimestampFromUlid(t.id));a++)if(s[a].id==t.id)return[...s.slice(0,a),t,...s.slice(a+1)];return[...s.slice(0,a),t,...s.slice(a)]}}else return[t]},k=async()=>{const s=n,t=await m.client.sendRequest(w.protos.Request.create({getUserMessages:w.protos.GetUserMessages.create({from:s,count:100,before:x.length!=0?x[0].id:void 0})}));if(!t.userMessages)throw b(!1),new Error(`Can't get messages ${JSON.stringify(t.error)}`);t.userMessages.messages.length==0?b(!1):N(a=>O(a,t.userMessages.messages))};c.useEffect(()=>{if(!h||!n)return;const s=(t,a)=>{a.userMessage&&(a.userMessage.from==n||a.userMessage.to==n)&&N(l=>P(l,a.userMessage))};return m.client.createUserChat(n).then(t=>{console.log(`Chat ID: ${t}`),y(!0),k()}).catch(t=>{console.error(t),ie({title:"User may not allow chat requests"}),y(!1)}),m.addEventListener(s),()=>m.removeEventListener(s)},[f]);const[u,M]=c.useState(""),[p,g]=c.useState(null),[L,b]=c.useState(!1);function q(s,t){throw new Error("Function not implemented.")}function H(s){g(s)}function A(){g(null)}function B(s){s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),z())}const h=c.useMemo(()=>f.username,[f]);function K(s){throw new Error("Function not implemented.")}async function z(){const s=u.trim();s.length!=0&&(m.client.sendUserMessage(w.protos.UserMessage.create({text:s,to:n})),M(""),g(null))}return R?e.jsxs("div",{className:"flex-1 flex flex-col h-full relative overflow-hidden",children:[e.jsxs("div",{className:"sticky top-0 z-30 bg-white border-b p-2 sm:p-4 flex items-center justify-between shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"md:hidden mr-1",onClick:()=>D(-1),children:e.jsx(G,{className:"h-5 w-5"})}),e.jsx(j,{username:n||""}),e.jsx("div",{children:e.jsx("p",{className:"font-medium text-sm sm:text-base",children:n})})]}),e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"hidden sm:inline-flex",children:e.jsx(ne,{className:"h-5 w-5"})}),e.jsx(i,{variant:"ghost",size:"icon",children:e.jsx(re,{className:"h-5 w-5"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"hidden sm:inline-flex",children:e.jsx(he,{className:"h-5 w-5"})}),e.jsx(i,{variant:"ghost",size:"icon",children:e.jsx(W,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"flex-1 relative overflow-hidden",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 sm:p-4 space-y-3 sm:space-y-4 lupyd-message-container",style:{height:"auto",maxHeight:"100%",paddingBottom:p?"140px":"100px",overflowX:"hidden",WebkitOverflowScrolling:"touch"},children:[e.jsx(ae,{next:k,hasMore:!L,loader:e.jsx($,{}),dataLength:x.length,inverse:!0,children:x.map(s=>{const t=s.from===h;return e.jsx("div",{className:`m-4 flex flex-col ${t?"items-end":"items-start"} "lupyd-message"`,children:e.jsxs("div",{className:`flex items-end ${t?"flex-row-reverse":""} space-x-2 ${t?"space-x-reverse":""}`,children:[!t&&e.jsx(j,{username:n||""}),e.jsx("div",{className:"max-w-[75%] sm:max-w-[70%] w-auto",children:e.jsxs("div",{className:`${t?"bg-black text-white":"bg-gray-100"} rounded-lg p-2 sm:p-3 relative group overflow-hidden`,children:[e.jsx("p",{className:"text-xs sm:text-sm break-words whitespace-pre-wrap overflow-hidden text-ellipsis",children:s.text}),e.jsx("p",{className:`text-[10px] sm:text-xs ${t?"text-gray-300":"text-muted-foreground"} mt-1`,children:r.dateToRelativeString(new Date(r.getTimestampFromUlid(s.id)))}),e.jsxs("div",{className:`absolute ${t?"left-0 translate-x-[-50%]":"right-0 translate-x-[50%]"} top-2 opacity-0 group-hover:opacity-100 transition-opacity bg-white rounded-full shadow-md flex items-center scale-75 md:scale-100 z-10`,children:[e.jsxs(C,{children:[e.jsx(E,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6",children:e.jsx(U,{className:"h-3 w-3"})})}),e.jsx(T,{className:"w-auto p-2",side:t?"left":"right",align:"center",sideOffset:5,children:e.jsx("div",{className:"flex gap-1",children:I.map(a=>e.jsx("button",{className:"text-lg hover:bg-gray-100 p-1 rounded",onClick:()=>q(s.id),children:a},a))})})]}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>H(s),children:e.jsx(F,{className:"h-3 w-3"})}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6",children:e.jsx(Z,{className:"h-3 w-3"})})}),e.jsxs(te,{side:t?"left":"right",children:[e.jsxs(v,{className:"flex items-center",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Forward"]}),e.jsxs(v,{className:"flex items-center",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Reply"]}),t&&e.jsxs(v,{className:"flex items-center text-red-600",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]})}),t&&e.jsx(j,{username:h})]})},r.ulidStringify(s.id))})}),e.jsx("div",{})]}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t z-50 w-full md:w-[calc(100%-16rem)]",style:{transform:"translateZ(0)"},children:[p&&e.jsxs("div",{className:"px-2 sm:px-4 py-2 bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center flex-1 overflow-hidden",children:[e.jsx("div",{className:"w-1 h-6 bg-black mr-2 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-xs font-medium",children:["Replying to ",p.from===h?"yourself":h]}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:p.text})]})]}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6 flex-shrink-0",onClick:A,children:e.jsx(S,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"p-2 sm:p-4",children:e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[e.jsxs("div",{className:"hidden sm:flex space-x-1",children:[e.jsx(i,{variant:"ghost",size:"icon",children:e.jsx(_,{className:"h-5 w-5"})}),e.jsx(i,{variant:"ghost",size:"icon",children:e.jsx(le,{className:"h-5 w-5"})}),e.jsx(i,{variant:"ghost",size:"icon",children:e.jsx(fe,{className:"h-5 w-5"})})]}),e.jsx(i,{variant:"ghost",size:"icon",className:"sm:hidden",children:e.jsx(_,{className:"h-5 w-5"})}),e.jsx(Q,{placeholder:"Type a message...",className:"bg-gray-100 border-none text-sm sm:text-base",value:u,onChange:s=>M(s.target.value),onKeyDown:B}),e.jsxs(C,{children:[e.jsx(E,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",children:e.jsx(U,{className:"h-5 w-5"})})}),e.jsx(T,{className:"w-auto p-2",align:"end",sideOffset:5,children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:I.map(s=>e.jsx("button",{className:"text-2xl hover:bg-gray-100 p-2 rounded",onClick:()=>{K()},children:s},s))})})]}),e.jsx(i,{size:"icon",className:"bg-black text-white hover:bg-gray-800",onClick:z,disabled:!u.trim(),children:e.jsx(ce,{className:"h-5 w-5"})})]})})]})]})]}):e.jsx("div",{children:e.jsx($,{})})}export{Ue as default};
