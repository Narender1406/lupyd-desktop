import{aY as L,J as F,r as C,j as A,aZ as D}from"./index-Fc6vCu0Z.js";var p={},S={},q;function E(){return q||(q=1,function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.UserMessages=a.UserMessage=a.ServerMessage=a.ClientMessage=a.Response=a.Error=a.Request=a.GetUserMessages=a.GroupMembers=a.GroupChannelMessages=a.GroupChannelMessage=a.GroupMember=a.RemoveUser=a.AddUser=a.GetGroupMessages=a.GetGroupMembers=a.GroupChat=a.GroupChannel=a.GroupChats=a.AuthenticationToken=a.VersionedMessage=a.protobufPackage=void 0;const s=L();a.protobufPackage="firefly";function m(){return{version:0,ts:0n,data:new Uint8Array(0)}}a.VersionedMessage={encode(e,n=new s.BinaryWriter){if(e.version!==0&&n.uint32(8).uint32(e.version),e.ts!==0n){if(BigInt.asUintN(64,e.ts)!==e.ts)throw new globalThis.Error("value provided for field message.ts of type uint64 too large");n.uint32(16).uint64(e.ts)}return e.data.length!==0&&n.uint32(26).bytes(e.data),n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=m();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==8)break;t.version=r.uint32();continue}case 2:{if(i!==16)break;t.ts=r.uint64();continue}case 3:{if(i!==26)break;t.data=r.bytes();continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{version:u(e.version)?globalThis.Number(e.version):0,ts:u(e.ts)?BigInt(e.ts):0n,data:u(e.data)?G(e.data):new Uint8Array(0)}},toJSON(e){const n={};return e.version!==0&&(n.version=Math.round(e.version)),e.ts!==0n&&(n.ts=e.ts.toString()),e.data.length!==0&&(n.data=I(e.data)),n},create(e){return a.VersionedMessage.fromPartial(e??{})},fromPartial(e){const n=m();return n.version=e.version??0,n.ts=e.ts??0n,n.data=e.data??new Uint8Array(0),n}};function g(){return{token:""}}a.AuthenticationToken={encode(e,n=new s.BinaryWriter){return e.token!==""&&n.uint32(10).string(e.token),n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=g();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==10)break;t.token=r.string();continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{token:u(e.token)?globalThis.String(e.token):""}},toJSON(e){const n={};return e.token!==""&&(n.token=e.token),n},create(e){return a.AuthenticationToken.fromPartial(e??{})},fromPartial(e){const n=g();return n.token=e.token??"",n}};function k(){return{chats:[]}}a.GroupChats={encode(e,n=new s.BinaryWriter){for(const r of e.chats)a.GroupChat.encode(r,n.uint32(10).fork()).join();return n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=k();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==10)break;t.chats.push(a.GroupChat.decode(r,r.uint32()));continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{chats:globalThis.Array.isArray(e?.chats)?e.chats.map(n=>a.GroupChat.fromJSON(n)):[]}},toJSON(e){const n={};return e.chats?.length&&(n.chats=e.chats.map(r=>a.GroupChat.toJSON(r))),n},create(e){return a.GroupChats.fromPartial(e??{})},fromPartial(e){const n=k();return n.chats=e.chats?.map(r=>a.GroupChat.fromPartial(r))||[],n}};function h(){return{groupId:0,channelId:0,channelType:0,name:""}}a.GroupChannel={encode(e,n=new s.BinaryWriter){return e.groupId!==0&&n.uint32(8).int32(e.groupId),e.channelId!==0&&n.uint32(16).int32(e.channelId),e.channelType!==0&&n.uint32(24).int32(e.channelType),e.name!==""&&n.uint32(34).string(e.name),n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=h();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==8)break;t.groupId=r.int32();continue}case 2:{if(i!==16)break;t.channelId=r.int32();continue}case 3:{if(i!==24)break;t.channelType=r.int32();continue}case 4:{if(i!==34)break;t.name=r.string();continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{groupId:u(e.groupId)?globalThis.Number(e.groupId):0,channelId:u(e.channelId)?globalThis.Number(e.channelId):0,channelType:u(e.channelType)?globalThis.Number(e.channelType):0,name:u(e.name)?globalThis.String(e.name):""}},toJSON(e){const n={};return e.groupId!==0&&(n.groupId=Math.round(e.groupId)),e.channelId!==0&&(n.channelId=Math.round(e.channelId)),e.channelType!==0&&(n.channelType=Math.round(e.channelType)),e.name!==""&&(n.name=e.name),n},create(e){return a.GroupChannel.fromPartial(e??{})},fromPartial(e){const n=h();return n.groupId=e.groupId??0,n.channelId=e.channelId??0,n.channelType=e.channelType??0,n.name=e.name??"",n}};function o(){return{name:"",groupId:0,channels:[]}}a.GroupChat={encode(e,n=new s.BinaryWriter){e.name!==""&&n.uint32(10).string(e.name),e.groupId!==0&&n.uint32(16).int32(e.groupId);for(const r of e.channels)a.GroupChannel.encode(r,n.uint32(26).fork()).join();return n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=o();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==10)break;t.name=r.string();continue}case 2:{if(i!==16)break;t.groupId=r.int32();continue}case 3:{if(i!==26)break;t.channels.push(a.GroupChannel.decode(r,r.uint32()));continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{name:u(e.name)?globalThis.String(e.name):"",groupId:u(e.groupId)?globalThis.Number(e.groupId):0,channels:globalThis.Array.isArray(e?.channels)?e.channels.map(n=>a.GroupChannel.fromJSON(n)):[]}},toJSON(e){const n={};return e.name!==""&&(n.name=e.name),e.groupId!==0&&(n.groupId=Math.round(e.groupId)),e.channels?.length&&(n.channels=e.channels.map(r=>a.GroupChannel.toJSON(r))),n},create(e){return a.GroupChat.fromPartial(e??{})},fromPartial(e){const n=o();return n.name=e.name??"",n.groupId=e.groupId??0,n.channels=e.channels?.map(r=>a.GroupChannel.fromPartial(r))||[],n}};function d(){return{groupId:0,channelId:0}}a.GetGroupMembers={encode(e,n=new s.BinaryWriter){return e.groupId!==0&&n.uint32(8).int32(e.groupId),e.channelId!==0&&n.uint32(16).int32(e.channelId),n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=d();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==8)break;t.groupId=r.int32();continue}case 2:{if(i!==16)break;t.channelId=r.int32();continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{groupId:u(e.groupId)?globalThis.Number(e.groupId):0,channelId:u(e.channelId)?globalThis.Number(e.channelId):0}},toJSON(e){const n={};return e.groupId!==0&&(n.groupId=Math.round(e.groupId)),e.channelId!==0&&(n.channelId=Math.round(e.channelId)),n},create(e){return a.GetGroupMembers.fromPartial(e??{})},fromPartial(e){const n=d();return n.groupId=e.groupId??0,n.channelId=e.channelId??0,n}};function l(){return{groupId:0,channelId:0,before:new Uint8Array(0),count:0}}a.GetGroupMessages={encode(e,n=new s.BinaryWriter){return e.groupId!==0&&n.uint32(8).int32(e.groupId),e.channelId!==0&&n.uint32(16).int32(e.channelId),e.before.length!==0&&n.uint32(26).bytes(e.before),e.count!==0&&n.uint32(32).uint32(e.count),n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=l();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==8)break;t.groupId=r.int32();continue}case 2:{if(i!==16)break;t.channelId=r.int32();continue}case 3:{if(i!==26)break;t.before=r.bytes();continue}case 4:{if(i!==32)break;t.count=r.uint32();continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{groupId:u(e.groupId)?globalThis.Number(e.groupId):0,channelId:u(e.channelId)?globalThis.Number(e.channelId):0,before:u(e.before)?G(e.before):new Uint8Array(0),count:u(e.count)?globalThis.Number(e.count):0}},toJSON(e){const n={};return e.groupId!==0&&(n.groupId=Math.round(e.groupId)),e.channelId!==0&&(n.channelId=Math.round(e.channelId)),e.before.length!==0&&(n.before=I(e.before)),e.count!==0&&(n.count=Math.round(e.count)),n},create(e){return a.GetGroupMessages.fromPartial(e??{})},fromPartial(e){const n=l();return n.groupId=e.groupId??0,n.channelId=e.channelId??0,n.before=e.before??new Uint8Array(0),n.count=e.count??0,n}};function c(){return{username:"",groupId:0,channelId:0,role:0}}a.AddUser={encode(e,n=new s.BinaryWriter){return e.username!==""&&n.uint32(10).string(e.username),e.groupId!==0&&n.uint32(16).int32(e.groupId),e.channelId!==0&&n.uint32(24).int32(e.channelId),e.role!==0&&n.uint32(32).int32(e.role),n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=c();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==10)break;t.username=r.string();continue}case 2:{if(i!==16)break;t.groupId=r.int32();continue}case 3:{if(i!==24)break;t.channelId=r.int32();continue}case 4:{if(i!==32)break;t.role=r.int32();continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{username:u(e.username)?globalThis.String(e.username):"",groupId:u(e.groupId)?globalThis.Number(e.groupId):0,channelId:u(e.channelId)?globalThis.Number(e.channelId):0,role:u(e.role)?globalThis.Number(e.role):0}},toJSON(e){const n={};return e.username!==""&&(n.username=e.username),e.groupId!==0&&(n.groupId=Math.round(e.groupId)),e.channelId!==0&&(n.channelId=Math.round(e.channelId)),e.role!==0&&(n.role=Math.round(e.role)),n},create(e){return a.AddUser.fromPartial(e??{})},fromPartial(e){const n=c();return n.username=e.username??"",n.groupId=e.groupId??0,n.channelId=e.channelId??0,n.role=e.role??0,n}};function M(){return{username:"",channelId:0,groupId:0}}a.RemoveUser={encode(e,n=new s.BinaryWriter){return e.username!==""&&n.uint32(10).string(e.username),e.channelId!==0&&n.uint32(16).int32(e.channelId),e.groupId!==0&&n.uint32(24).int32(e.groupId),n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=M();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==10)break;t.username=r.string();continue}case 2:{if(i!==16)break;t.channelId=r.int32();continue}case 3:{if(i!==24)break;t.groupId=r.int32();continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{username:u(e.username)?globalThis.String(e.username):"",channelId:u(e.channelId)?globalThis.Number(e.channelId):0,groupId:u(e.groupId)?globalThis.Number(e.groupId):0}},toJSON(e){const n={};return e.username!==""&&(n.username=e.username),e.channelId!==0&&(n.channelId=Math.round(e.channelId)),e.groupId!==0&&(n.groupId=Math.round(e.groupId)),n},create(e){return a.RemoveUser.fromPartial(e??{})},fromPartial(e){const n=M();return n.username=e.username??"",n.channelId=e.channelId??0,n.groupId=e.groupId??0,n}};function y(){return{username:"",lastSeen:0n,isOnline:!1,role:0,chanId:0}}a.GroupMember={encode(e,n=new s.BinaryWriter){if(e.username!==""&&n.uint32(10).string(e.username),e.lastSeen!==0n){if(BigInt.asUintN(64,e.lastSeen)!==e.lastSeen)throw new globalThis.Error("value provided for field message.lastSeen of type uint64 too large");n.uint32(16).uint64(e.lastSeen)}return e.isOnline!==!1&&n.uint32(24).bool(e.isOnline),e.role!==0&&n.uint32(32).int32(e.role),e.chanId!==0&&n.uint32(40).int32(e.chanId),n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=y();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==10)break;t.username=r.string();continue}case 2:{if(i!==16)break;t.lastSeen=r.uint64();continue}case 3:{if(i!==24)break;t.isOnline=r.bool();continue}case 4:{if(i!==32)break;t.role=r.int32();continue}case 5:{if(i!==40)break;t.chanId=r.int32();continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{username:u(e.username)?globalThis.String(e.username):"",lastSeen:u(e.lastSeen)?BigInt(e.lastSeen):0n,isOnline:u(e.isOnline)?globalThis.Boolean(e.isOnline):!1,role:u(e.role)?globalThis.Number(e.role):0,chanId:u(e.chanId)?globalThis.Number(e.chanId):0}},toJSON(e){const n={};return e.username!==""&&(n.username=e.username),e.lastSeen!==0n&&(n.lastSeen=e.lastSeen.toString()),e.isOnline!==!1&&(n.isOnline=e.isOnline),e.role!==0&&(n.role=Math.round(e.role)),e.chanId!==0&&(n.chanId=Math.round(e.chanId)),n},create(e){return a.GroupMember.fromPartial(e??{})},fromPartial(e){const n=y();return n.username=e.username??"",n.lastSeen=e.lastSeen??0n,n.isOnline=e.isOnline??!1,n.role=e.role??0,n.chanId=e.chanId??0,n}};function U(){return{id:new Uint8Array(0),groupId:0,channelId:0,content:"",by:""}}a.GroupChannelMessage={encode(e,n=new s.BinaryWriter){return e.id.length!==0&&n.uint32(10).bytes(e.id),e.groupId!==0&&n.uint32(16).int32(e.groupId),e.channelId!==0&&n.uint32(24).int32(e.channelId),e.content!==""&&n.uint32(34).string(e.content),e.by!==""&&n.uint32(42).string(e.by),n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=U();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==10)break;t.id=r.bytes();continue}case 2:{if(i!==16)break;t.groupId=r.int32();continue}case 3:{if(i!==24)break;t.channelId=r.int32();continue}case 4:{if(i!==34)break;t.content=r.string();continue}case 5:{if(i!==42)break;t.by=r.string();continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{id:u(e.id)?G(e.id):new Uint8Array(0),groupId:u(e.groupId)?globalThis.Number(e.groupId):0,channelId:u(e.channelId)?globalThis.Number(e.channelId):0,content:u(e.content)?globalThis.String(e.content):"",by:u(e.by)?globalThis.String(e.by):""}},toJSON(e){const n={};return e.id.length!==0&&(n.id=I(e.id)),e.groupId!==0&&(n.groupId=Math.round(e.groupId)),e.channelId!==0&&(n.channelId=Math.round(e.channelId)),e.content!==""&&(n.content=e.content),e.by!==""&&(n.by=e.by),n},create(e){return a.GroupChannelMessage.fromPartial(e??{})},fromPartial(e){const n=U();return n.id=e.id??new Uint8Array(0),n.groupId=e.groupId??0,n.channelId=e.channelId??0,n.content=e.content??"",n.by=e.by??"",n}};function b(){return{messages:[]}}a.GroupChannelMessages={encode(e,n=new s.BinaryWriter){for(const r of e.messages)a.GroupChannelMessage.encode(r,n.uint32(10).fork()).join();return n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=b();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==10)break;t.messages.push(a.GroupChannelMessage.decode(r,r.uint32()));continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{messages:globalThis.Array.isArray(e?.messages)?e.messages.map(n=>a.GroupChannelMessage.fromJSON(n)):[]}},toJSON(e){const n={};return e.messages?.length&&(n.messages=e.messages.map(r=>a.GroupChannelMessage.toJSON(r))),n},create(e){return a.GroupChannelMessages.fromPartial(e??{})},fromPartial(e){const n=b();return n.messages=e.messages?.map(r=>a.GroupChannelMessage.fromPartial(r))||[],n}};function N(){return{members:[]}}a.GroupMembers={encode(e,n=new s.BinaryWriter){for(const r of e.members)a.GroupMember.encode(r,n.uint32(10).fork()).join();return n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=N();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==10)break;t.members.push(a.GroupMember.decode(r,r.uint32()));continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{members:globalThis.Array.isArray(e?.members)?e.members.map(n=>a.GroupMember.fromJSON(n)):[]}},toJSON(e){const n={};return e.members?.length&&(n.members=e.members.map(r=>a.GroupMember.toJSON(r))),n},create(e){return a.GroupMembers.fromPartial(e??{})},fromPartial(e){const n=N();return n.members=e.members?.map(r=>a.GroupMember.fromPartial(r))||[],n}};function O(){return{before:new Uint8Array(0),count:0,from:""}}a.GetUserMessages={encode(e,n=new s.BinaryWriter){return e.before.length!==0&&n.uint32(10).bytes(e.before),e.count!==0&&n.uint32(16).int32(e.count),e.from!==""&&n.uint32(26).string(e.from),n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=O();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==10)break;t.before=r.bytes();continue}case 2:{if(i!==16)break;t.count=r.int32();continue}case 3:{if(i!==26)break;t.from=r.string();continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{before:u(e.before)?G(e.before):new Uint8Array(0),count:u(e.count)?globalThis.Number(e.count):0,from:u(e.from)?globalThis.String(e.from):""}},toJSON(e){const n={};return e.before.length!==0&&(n.before=I(e.before)),e.count!==0&&(n.count=Math.round(e.count)),e.from!==""&&(n.from=e.from),n},create(e){return a.GetUserMessages.fromPartial(e??{})},fromPartial(e){const n=O();return n.before=e.before??new Uint8Array(0),n.count=e.count??0,n.from=e.from??"",n}};function T(){return{id:0,getGroupMembers:void 0,getGroupMessages:void 0,addUser:void 0,removeUser:void 0,addChannel:void 0,deleteChannel:void 0,getUserMessages:void 0}}a.Request={encode(e,n=new s.BinaryWriter){return e.id!==0&&n.uint32(8).int32(e.id),e.getGroupMembers!==void 0&&a.GetGroupMembers.encode(e.getGroupMembers,n.uint32(18).fork()).join(),e.getGroupMessages!==void 0&&a.GetGroupMessages.encode(e.getGroupMessages,n.uint32(26).fork()).join(),e.addUser!==void 0&&a.AddUser.encode(e.addUser,n.uint32(34).fork()).join(),e.removeUser!==void 0&&a.RemoveUser.encode(e.removeUser,n.uint32(42).fork()).join(),e.addChannel!==void 0&&a.GroupChannel.encode(e.addChannel,n.uint32(50).fork()).join(),e.deleteChannel!==void 0&&a.GroupChannel.encode(e.deleteChannel,n.uint32(58).fork()).join(),e.getUserMessages!==void 0&&a.GetUserMessages.encode(e.getUserMessages,n.uint32(66).fork()).join(),n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=T();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==8)break;t.id=r.int32();continue}case 2:{if(i!==18)break;t.getGroupMembers=a.GetGroupMembers.decode(r,r.uint32());continue}case 3:{if(i!==26)break;t.getGroupMessages=a.GetGroupMessages.decode(r,r.uint32());continue}case 4:{if(i!==34)break;t.addUser=a.AddUser.decode(r,r.uint32());continue}case 5:{if(i!==42)break;t.removeUser=a.RemoveUser.decode(r,r.uint32());continue}case 6:{if(i!==50)break;t.addChannel=a.GroupChannel.decode(r,r.uint32());continue}case 7:{if(i!==58)break;t.deleteChannel=a.GroupChannel.decode(r,r.uint32());continue}case 8:{if(i!==66)break;t.getUserMessages=a.GetUserMessages.decode(r,r.uint32());continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{id:u(e.id)?globalThis.Number(e.id):0,getGroupMembers:u(e.getGroupMembers)?a.GetGroupMembers.fromJSON(e.getGroupMembers):void 0,getGroupMessages:u(e.getGroupMessages)?a.GetGroupMessages.fromJSON(e.getGroupMessages):void 0,addUser:u(e.addUser)?a.AddUser.fromJSON(e.addUser):void 0,removeUser:u(e.removeUser)?a.RemoveUser.fromJSON(e.removeUser):void 0,addChannel:u(e.addChannel)?a.GroupChannel.fromJSON(e.addChannel):void 0,deleteChannel:u(e.deleteChannel)?a.GroupChannel.fromJSON(e.deleteChannel):void 0,getUserMessages:u(e.getUserMessages)?a.GetUserMessages.fromJSON(e.getUserMessages):void 0}},toJSON(e){const n={};return e.id!==0&&(n.id=Math.round(e.id)),e.getGroupMembers!==void 0&&(n.getGroupMembers=a.GetGroupMembers.toJSON(e.getGroupMembers)),e.getGroupMessages!==void 0&&(n.getGroupMessages=a.GetGroupMessages.toJSON(e.getGroupMessages)),e.addUser!==void 0&&(n.addUser=a.AddUser.toJSON(e.addUser)),e.removeUser!==void 0&&(n.removeUser=a.RemoveUser.toJSON(e.removeUser)),e.addChannel!==void 0&&(n.addChannel=a.GroupChannel.toJSON(e.addChannel)),e.deleteChannel!==void 0&&(n.deleteChannel=a.GroupChannel.toJSON(e.deleteChannel)),e.getUserMessages!==void 0&&(n.getUserMessages=a.GetUserMessages.toJSON(e.getUserMessages)),n},create(e){return a.Request.fromPartial(e??{})},fromPartial(e){const n=T();return n.id=e.id??0,n.getGroupMembers=e.getGroupMembers!==void 0&&e.getGroupMembers!==null?a.GetGroupMembers.fromPartial(e.getGroupMembers):void 0,n.getGroupMessages=e.getGroupMessages!==void 0&&e.getGroupMessages!==null?a.GetGroupMessages.fromPartial(e.getGroupMessages):void 0,n.addUser=e.addUser!==void 0&&e.addUser!==null?a.AddUser.fromPartial(e.addUser):void 0,n.removeUser=e.removeUser!==void 0&&e.removeUser!==null?a.RemoveUser.fromPartial(e.removeUser):void 0,n.addChannel=e.addChannel!==void 0&&e.addChannel!==null?a.GroupChannel.fromPartial(e.addChannel):void 0,n.deleteChannel=e.deleteChannel!==void 0&&e.deleteChannel!==null?a.GroupChannel.fromPartial(e.deleteChannel):void 0,n.getUserMessages=e.getUserMessages!==void 0&&e.getUserMessages!==null?a.GetUserMessages.fromPartial(e.getUserMessages):void 0,n}};function w(){return{status:0,error:""}}a.Error={encode(e,n=new s.BinaryWriter){return e.status!==0&&n.uint32(8).int32(e.status),e.error!==""&&n.uint32(18).string(e.error),n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=w();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==8)break;t.status=r.int32();continue}case 2:{if(i!==18)break;t.error=r.string();continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{status:u(e.status)?globalThis.Number(e.status):0,error:u(e.error)?globalThis.String(e.error):""}},toJSON(e){const n={};return e.status!==0&&(n.status=Math.round(e.status)),e.error!==""&&(n.error=e.error),n},create(e){return a.Error.fromPartial(e??{})},fromPartial(e){const n=w();return n.status=e.status??0,n.error=e.error??"",n}};function B(){return{id:0,error:void 0,groupMembers:void 0,groupMessages:void 0,userMessages:void 0,channel:void 0}}a.Response={encode(e,n=new s.BinaryWriter){return e.id!==0&&n.uint32(8).int32(e.id),e.error!==void 0&&a.Error.encode(e.error,n.uint32(18).fork()).join(),e.groupMembers!==void 0&&a.GroupMembers.encode(e.groupMembers,n.uint32(26).fork()).join(),e.groupMessages!==void 0&&a.GroupChannelMessages.encode(e.groupMessages,n.uint32(34).fork()).join(),e.userMessages!==void 0&&a.UserMessages.encode(e.userMessages,n.uint32(42).fork()).join(),e.channel!==void 0&&a.GroupChannel.encode(e.channel,n.uint32(50).fork()).join(),n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=B();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==8)break;t.id=r.int32();continue}case 2:{if(i!==18)break;t.error=a.Error.decode(r,r.uint32());continue}case 3:{if(i!==26)break;t.groupMembers=a.GroupMembers.decode(r,r.uint32());continue}case 4:{if(i!==34)break;t.groupMessages=a.GroupChannelMessages.decode(r,r.uint32());continue}case 5:{if(i!==42)break;t.userMessages=a.UserMessages.decode(r,r.uint32());continue}case 6:{if(i!==50)break;t.channel=a.GroupChannel.decode(r,r.uint32());continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{id:u(e.id)?globalThis.Number(e.id):0,error:u(e.error)?a.Error.fromJSON(e.error):void 0,groupMembers:u(e.groupMembers)?a.GroupMembers.fromJSON(e.groupMembers):void 0,groupMessages:u(e.groupMessages)?a.GroupChannelMessages.fromJSON(e.groupMessages):void 0,userMessages:u(e.userMessages)?a.UserMessages.fromJSON(e.userMessages):void 0,channel:u(e.channel)?a.GroupChannel.fromJSON(e.channel):void 0}},toJSON(e){const n={};return e.id!==0&&(n.id=Math.round(e.id)),e.error!==void 0&&(n.error=a.Error.toJSON(e.error)),e.groupMembers!==void 0&&(n.groupMembers=a.GroupMembers.toJSON(e.groupMembers)),e.groupMessages!==void 0&&(n.groupMessages=a.GroupChannelMessages.toJSON(e.groupMessages)),e.userMessages!==void 0&&(n.userMessages=a.UserMessages.toJSON(e.userMessages)),e.channel!==void 0&&(n.channel=a.GroupChannel.toJSON(e.channel)),n},create(e){return a.Response.fromPartial(e??{})},fromPartial(e){const n=B();return n.id=e.id??0,n.error=e.error!==void 0&&e.error!==null?a.Error.fromPartial(e.error):void 0,n.groupMembers=e.groupMembers!==void 0&&e.groupMembers!==null?a.GroupMembers.fromPartial(e.groupMembers):void 0,n.groupMessages=e.groupMessages!==void 0&&e.groupMessages!==null?a.GroupChannelMessages.fromPartial(e.groupMessages):void 0,n.userMessages=e.userMessages!==void 0&&e.userMessages!==null?a.UserMessages.fromPartial(e.userMessages):void 0,n.channel=e.channel!==void 0&&e.channel!==null?a.GroupChannel.fromPartial(e.channel):void 0,n}};function J(){return{request:void 0,groupMessage:void 0,authToken:void 0,currentGroup:void 0,userMessage:void 0}}a.ClientMessage={encode(e,n=new s.BinaryWriter){return e.request!==void 0&&a.Request.encode(e.request,n.uint32(18).fork()).join(),e.groupMessage!==void 0&&a.GroupChannelMessage.encode(e.groupMessage,n.uint32(26).fork()).join(),e.authToken!==void 0&&a.AuthenticationToken.encode(e.authToken,n.uint32(34).fork()).join(),e.currentGroup!==void 0&&n.uint32(40).int32(e.currentGroup),e.userMessage!==void 0&&a.UserMessage.encode(e.userMessage,n.uint32(50).fork()).join(),n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=J();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 2:{if(i!==18)break;t.request=a.Request.decode(r,r.uint32());continue}case 3:{if(i!==26)break;t.groupMessage=a.GroupChannelMessage.decode(r,r.uint32());continue}case 4:{if(i!==34)break;t.authToken=a.AuthenticationToken.decode(r,r.uint32());continue}case 5:{if(i!==40)break;t.currentGroup=r.int32();continue}case 6:{if(i!==50)break;t.userMessage=a.UserMessage.decode(r,r.uint32());continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{request:u(e.request)?a.Request.fromJSON(e.request):void 0,groupMessage:u(e.groupMessage)?a.GroupChannelMessage.fromJSON(e.groupMessage):void 0,authToken:u(e.authToken)?a.AuthenticationToken.fromJSON(e.authToken):void 0,currentGroup:u(e.currentGroup)?globalThis.Number(e.currentGroup):void 0,userMessage:u(e.userMessage)?a.UserMessage.fromJSON(e.userMessage):void 0}},toJSON(e){const n={};return e.request!==void 0&&(n.request=a.Request.toJSON(e.request)),e.groupMessage!==void 0&&(n.groupMessage=a.GroupChannelMessage.toJSON(e.groupMessage)),e.authToken!==void 0&&(n.authToken=a.AuthenticationToken.toJSON(e.authToken)),e.currentGroup!==void 0&&(n.currentGroup=Math.round(e.currentGroup)),e.userMessage!==void 0&&(n.userMessage=a.UserMessage.toJSON(e.userMessage)),n},create(e){return a.ClientMessage.fromPartial(e??{})},fromPartial(e){const n=J();return n.request=e.request!==void 0&&e.request!==null?a.Request.fromPartial(e.request):void 0,n.groupMessage=e.groupMessage!==void 0&&e.groupMessage!==null?a.GroupChannelMessage.fromPartial(e.groupMessage):void 0,n.authToken=e.authToken!==void 0&&e.authToken!==null?a.AuthenticationToken.fromPartial(e.authToken):void 0,n.currentGroup=e.currentGroup??void 0,n.userMessage=e.userMessage!==void 0&&e.userMessage!==null?a.UserMessage.fromPartial(e.userMessage):void 0,n}};function v(){return{response:void 0,groupChats:void 0,groupChat:void 0,groupMessage:void 0,userMessage:void 0,userChats:void 0}}a.ServerMessage={encode(e,n=new s.BinaryWriter){return e.response!==void 0&&a.Response.encode(e.response,n.uint32(10).fork()).join(),e.groupChats!==void 0&&a.GroupChats.encode(e.groupChats,n.uint32(18).fork()).join(),e.groupChat!==void 0&&a.GroupChat.encode(e.groupChat,n.uint32(26).fork()).join(),e.groupMessage!==void 0&&a.GroupChannelMessage.encode(e.groupMessage,n.uint32(34).fork()).join(),e.userMessage!==void 0&&a.UserMessage.encode(e.userMessage,n.uint32(42).fork()).join(),e.userChats!==void 0&&a.UserMessages.encode(e.userChats,n.uint32(50).fork()).join(),n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=v();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==10)break;t.response=a.Response.decode(r,r.uint32());continue}case 2:{if(i!==18)break;t.groupChats=a.GroupChats.decode(r,r.uint32());continue}case 3:{if(i!==26)break;t.groupChat=a.GroupChat.decode(r,r.uint32());continue}case 4:{if(i!==34)break;t.groupMessage=a.GroupChannelMessage.decode(r,r.uint32());continue}case 5:{if(i!==42)break;t.userMessage=a.UserMessage.decode(r,r.uint32());continue}case 6:{if(i!==50)break;t.userChats=a.UserMessages.decode(r,r.uint32());continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{response:u(e.response)?a.Response.fromJSON(e.response):void 0,groupChats:u(e.groupChats)?a.GroupChats.fromJSON(e.groupChats):void 0,groupChat:u(e.groupChat)?a.GroupChat.fromJSON(e.groupChat):void 0,groupMessage:u(e.groupMessage)?a.GroupChannelMessage.fromJSON(e.groupMessage):void 0,userMessage:u(e.userMessage)?a.UserMessage.fromJSON(e.userMessage):void 0,userChats:u(e.userChats)?a.UserMessages.fromJSON(e.userChats):void 0}},toJSON(e){const n={};return e.response!==void 0&&(n.response=a.Response.toJSON(e.response)),e.groupChats!==void 0&&(n.groupChats=a.GroupChats.toJSON(e.groupChats)),e.groupChat!==void 0&&(n.groupChat=a.GroupChat.toJSON(e.groupChat)),e.groupMessage!==void 0&&(n.groupMessage=a.GroupChannelMessage.toJSON(e.groupMessage)),e.userMessage!==void 0&&(n.userMessage=a.UserMessage.toJSON(e.userMessage)),e.userChats!==void 0&&(n.userChats=a.UserMessages.toJSON(e.userChats)),n},create(e){return a.ServerMessage.fromPartial(e??{})},fromPartial(e){const n=v();return n.response=e.response!==void 0&&e.response!==null?a.Response.fromPartial(e.response):void 0,n.groupChats=e.groupChats!==void 0&&e.groupChats!==null?a.GroupChats.fromPartial(e.groupChats):void 0,n.groupChat=e.groupChat!==void 0&&e.groupChat!==null?a.GroupChat.fromPartial(e.groupChat):void 0,n.groupMessage=e.groupMessage!==void 0&&e.groupMessage!==null?a.GroupChannelMessage.fromPartial(e.groupMessage):void 0,n.userMessage=e.userMessage!==void 0&&e.userMessage!==null?a.UserMessage.fromPartial(e.userMessage):void 0,n.userChats=e.userChats!==void 0&&e.userChats!==null?a.UserMessages.fromPartial(e.userChats):void 0,n}};function R(){return{id:new Uint8Array(0),version:0,text:"",to:"",from:""}}a.UserMessage={encode(e,n=new s.BinaryWriter){return e.id.length!==0&&n.uint32(10).bytes(e.id),e.version!==0&&n.uint32(16).int32(e.version),e.text!==""&&n.uint32(26).string(e.text),e.to!==""&&n.uint32(34).string(e.to),e.from!==""&&n.uint32(42).string(e.from),n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=R();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==10)break;t.id=r.bytes();continue}case 2:{if(i!==16)break;t.version=r.int32();continue}case 3:{if(i!==26)break;t.text=r.string();continue}case 4:{if(i!==34)break;t.to=r.string();continue}case 5:{if(i!==42)break;t.from=r.string();continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{id:u(e.id)?G(e.id):new Uint8Array(0),version:u(e.version)?globalThis.Number(e.version):0,text:u(e.text)?globalThis.String(e.text):"",to:u(e.to)?globalThis.String(e.to):"",from:u(e.from)?globalThis.String(e.from):""}},toJSON(e){const n={};return e.id.length!==0&&(n.id=I(e.id)),e.version!==0&&(n.version=Math.round(e.version)),e.text!==""&&(n.text=e.text),e.to!==""&&(n.to=e.to),e.from!==""&&(n.from=e.from),n},create(e){return a.UserMessage.fromPartial(e??{})},fromPartial(e){const n=R();return n.id=e.id??new Uint8Array(0),n.version=e.version??0,n.text=e.text??"",n.to=e.to??"",n.from=e.from??"",n}};function P(){return{messages:[]}}a.UserMessages={encode(e,n=new s.BinaryWriter){for(const r of e.messages)a.UserMessage.encode(r,n.uint32(10).fork()).join();return n},decode(e,n){const r=e instanceof s.BinaryReader?e:new s.BinaryReader(e),f=n===void 0?r.len:r.pos+n,t=P();for(;r.pos<f;){const i=r.uint32();switch(i>>>3){case 1:{if(i!==10)break;t.messages.push(a.UserMessage.decode(r,r.uint32()));continue}}if((i&7)===4||i===0)break;r.skip(i&7)}return t},fromJSON(e){return{messages:globalThis.Array.isArray(e?.messages)?e.messages.map(n=>a.UserMessage.fromJSON(n)):[]}},toJSON(e){const n={};return e.messages?.length&&(n.messages=e.messages.map(r=>a.UserMessage.toJSON(r))),n},create(e){return a.UserMessages.fromPartial(e??{})},fromPartial(e){const n=P();return n.messages=e.messages?.map(r=>a.UserMessage.fromPartial(r))||[],n}};function G(e){const n=globalThis.atob(e),r=new Uint8Array(n.length);for(let f=0;f<n.length;++f)r[f]=n.charCodeAt(f);return r}function I(e){const n=[];return e.forEach(r=>{n.push(globalThis.String.fromCharCode(r))}),globalThis.btoa(n.join(""))}function u(e){return e!=null}}(S)),S}var _;function z(){if(_)return p;_=1;var a=p&&p.__createBinding||(Object.create?function(h,o,d,l){l===void 0&&(l=d);var c=Object.getOwnPropertyDescriptor(o,d);(!c||("get"in c?!o.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return o[d]}}),Object.defineProperty(h,l,c)}:function(h,o,d,l){l===void 0&&(l=d),h[l]=o[d]}),s=p&&p.__setModuleDefault||(Object.create?function(h,o){Object.defineProperty(h,"default",{enumerable:!0,value:o})}:function(h,o){h.default=o}),m=p&&p.__importStar||function(){var h=function(o){return h=Object.getOwnPropertyNames||function(d){var l=[];for(var c in d)Object.prototype.hasOwnProperty.call(d,c)&&(l[l.length]=c);return l},h(o)};return function(o){if(o&&o.__esModule)return o;var d={};if(o!=null)for(var l=h(o),c=0;c<l.length;c++)l[c]!=="default"&&a(d,o,l[c]);return s(d,o),d}}();Object.defineProperty(p,"__esModule",{value:!0}),p.FireflyClient=p.protos=void 0;const g=m(E());p.protos=m(E());class k{maxRetries=3;waitTimeBeforeReconnectingFromLastConnection=5*1e3;connectionTimeout=5*1e3;responseTimeout=5*1e3;pendingRequests=new Map;apiUrl;websocketUrl;authToken;onMessageCallback;onRetryLimitExceeded;ws=void 0;requestIdCounter=0;retriesLeft=this.maxRetries;lastConnectionAttemptTimestamp=0;disposed=!1;constructor(o,d,l,c,M){this.apiUrl=o,this.websocketUrl=d,this.authToken=l,this.onMessageCallback=c,this.onRetryLimitExceeded=M}initialize(){return this.retriesLeft=this.maxRetries,this.disposed=!1,this.connect()}async connect(){await new Promise((d,l)=>setTimeout(()=>d(0),Math.max(0,this.waitTimeBeforeReconnectingFromLastConnection-(Date.now()-this.lastConnectionAttemptTimestamp)))),console.log(`Connecting to websocket ${this.websocketUrl}`);const o=new WebSocket(this.websocketUrl);o.binaryType="arraybuffer",this.lastConnectionAttemptTimestamp=Date.now(),this.ws=o,setTimeout(()=>{o.readyState!==o.OPEN&&o.close()},this.connectionTimeout),o.addEventListener("message",d=>{d.data instanceof ArrayBuffer?this.onMessage(d.data):console.warn("Unhandled data format",d.data)}),o.addEventListener("error",d=>{console.error(d)}),o.addEventListener("close",d=>{console.log(`Websocket closed with code: ${d.code}`),this.ws=void 0,!this.disposed&&(this.retriesLeft>0?(this.connect(),this.retriesLeft--):this.onRetryLimitExceeded())}),o.addEventListener("open",async()=>{console.log("Connection opened"),this.retriesLeft=this.maxRetries;const d=await this.authToken();this.sendData(g.ClientMessage.encode(g.ClientMessage.create({authToken:{token:d}})).finish().buffer)})}dispose(){this.ws&&(this.disposed=!0,this.ws.close())}onMessage(o){const d=g.ServerMessage.decode(new Uint8Array(o));if(d.response){const l=this.pendingRequests.get(d.response.id);l&&(l(d.response),this.pendingRequests.delete(d.response.id))}else this.onMessageCallback(d)}sendData(o){this.ws?this.ws.send(o):console.warn("websocket not initialized")}sendGroupMessage(o){this.sendData(g.ClientMessage.encode(g.ClientMessage.create({groupMessage:o})).finish().buffer)}sendUserMessage(o){this.sendData(g.ClientMessage.encode(g.ClientMessage.create({userMessage:o})).finish().buffer)}getNewRequestId(){return this.requestIdCounter++,this.requestIdCounter}sendRequest(o){return new Promise((d,l)=>{o.id=this.getNewRequestId(),this.pendingRequests.set(o.id,d),this.sendData(g.ClientMessage.encode(g.ClientMessage.create({request:o})).finish().buffer),setTimeout(()=>{this.pendingRequests.get(o.id)&&(l(Error(`Didn't receive response in the time ${this.responseTimeout}ms`)),this.pendingRequests.delete(o.id))},this.responseTimeout)})}async createUserChat(o){const d=await this.authToken(),l=`${this.apiUrl}/user`,c=await fetch(l,{headers:{authorization:`Bearer ${d}`},method:"POST",body:o});if(c.status!=200&&c.status!=201)throw new Error(`unexpected statuc: ${c.status} ${await c.text()}`);return new Uint8Array(await c.arrayBuffer())}async getUserChats(){const o=await this.authToken(),d=`${this.apiUrl}/users`,l=await fetch(d,{headers:{authorization:`Bearer ${o}`}});if(l.status!=200)throw new Error(`unexpected statuc: ${l.status} ${await l.text()}`);return g.UserMessages.decode(new Uint8Array(await l.arrayBuffer())).messages}async createGroupChat(o){const d=await this.authToken(),l=`${this.apiUrl}/group`,c=await fetch(l,{headers:{authorization:`Bearer ${d}`},method:"POST",body:new Uint8Array(g.GroupChat.encode(o).finish())});if(c.status!=200&&c.status!=201)throw new Error(`unexpected statuc: ${c.status} ${await c.text()}`);return g.GroupChat.decode(new Uint8Array(await c.arrayBuffer()))}async getGroupChats(){const o=await this.authToken(),d=`${this.apiUrl}/groups`,l=await fetch(d,{headers:{authorization:`Bearer ${o}`}});if(l.status!=200)throw new Error(`unexpected statuc: ${l.status} ${await l.text()}`);return g.GroupChats.decode(new Uint8Array(await l.arrayBuffer())).chats}}return p.FireflyClient=k,p}var W=z();const $=C.createContext(void 0);function V(){const a=F(),s=C.useRef(new Set),m="http://127.0.0.1:37373",g="ws://127.0.0.1:37373/ws",k=()=>new W.FireflyClient(m,g,async()=>{const M=await a.getToken();if(M)return M;throw Error("Not authenticated")},d,()=>{console.error("Retrying failed")}),[h,o]=C.useState(k());C.useEffect(()=>()=>{h.dispose()},[]),C.useEffect(()=>{a.username&&h.initialize().then(()=>console.log("Firefly initialized")).catch(console.error)},[a]);function d(M){for(const y of s.current)y(h,W.protos.ServerMessage.create({...M}))}const l=M=>{s.current.add(M)},c=M=>{s.current.delete(M)};return A.jsxs($.Provider,{value:{client:h,addEventListener:l,removeEventListener:c,initialize:h.initialize,dispose:h.dispose},children:[" ",A.jsx(D,{})," "]})}function K(){const a=C.useContext($);if(a===void 0)throw new Error("useFirefly must be used within an FireflyProvider");return a}const Z=Object.freeze(Object.defineProperty({__proto__:null,default:V,useFirefly:K},Symbol.toStringTag,{value:"Module"}));export{W as d,Z as f,K as u};
